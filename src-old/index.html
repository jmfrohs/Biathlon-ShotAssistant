<!--
MIT License

Copyright (c) 2026 jmfrohs

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Schie√üstandhelferein</title>
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css" />

    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  </head>

  <body class="p-8">
    <!-- √úbersicht Einheiten -->
    <div id="view-sessions" class="max-w-5xl mx-auto page-transition min-h-screen">
      <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
        <div>
          <h1
            class="text-4xl font-bold tracking-tight bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent"
          >
            <span id="trainer-name-display"></span>'s Schie√üstandhelferlein :)
          </h1>
          <p class="text-slate-400 mt-1">Fr√§nki pass auf dein Herz auf ;)</p>
        </div>
        <div class="flex gap-2 md:gap-3 flex-wrap md:flex-nowrap">
          <button
            onclick="openHistoryViewer()"
            class="p-3 bg-slate-800/50 hover:bg-indigo-600/20 rounded-xl transition-all border border-slate-700/50 hover:border-indigo-500/50 backdrop-blur"
            title="Alle Athleten & Serien"
          >
            üìä
          </button>
          <select
            id="history-filter-type"
            onchange="filterHistoryByType()"
            class="bg-slate-800/50 border border-slate-700/50 rounded-xl px-3 py-3 text-slate-200 text-sm outline-none focus:border-indigo-500 hover:bg-slate-700/50 transition-all backdrop-blur"
          >
            <option value="">Alle Typen</option>
            <option value="Training">Training</option>
            <option value="Wettkampf">Wettkampf</option>
            <option value="Anschie√üen">Anschie√üen</option>
          </select>
          <button
            onclick="openSettings()"
            class="p-3 bg-slate-800/50 hover:bg-indigo-600/20 rounded-xl transition-all border border-slate-700/50 hover:border-indigo-500/50 backdrop-blur"
          >
            ‚öôÔ∏è
          </button>
          <button
            onclick="openSessionModal()"
            class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 px-6 py-3 rounded-xl font-bold shadow-lg shadow-indigo-500/30 transition-all hover:shadow-indigo-500/50 backdrop-blur"
          >
            Neue Einheit
          </button>
        </div>
      </div>
      <div class="grid gap-4" id="session-list"></div>
    </div>

    <!-- √úbersicht Athleten -->
    <div id="view-athletes" class="max-w-5xl mx-auto hidden page-transition min-h-screen">
      <div class="flex items-center gap-4 mb-8">
        <button
          onclick="showSessionsView()"
          class="p-2 hover:bg-slate-800 rounded-full transition-all"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8 text-indigo-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <div class="flex-1">
          <h1 id="view-athletes-title" class="text-3xl font-bold"></h1>
          <p id="view-athletes-subtitle" class="text-slate-400"></p>
        </div>
        <button
          onclick="openSessionSettings()"
          class="p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-all border border-slate-700"
        >
          ‚öôÔ∏è
        </button>
      </div>

      <div class="grid gap-4" id="athletes-in-session-list"></div>
    </div>

    <!-- √úbersicht Serien einzelner Athleten -->
    <div id="view-athlete-detail" class="max-w-5xl mx-auto hidden page-transition min-h-screen">
      <div class="flex items-center gap-4 mb-8">
        <button
          onclick="backToAthletes()"
          class="p-2 hover:bg-slate-800 rounded-full transition-all"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-8 w-8 text-indigo-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <div class="flex-1">
          <h1 id="athlete-detail-name" class="text-3xl font-bold">Athlet</h1>
          <p id="athlete-detail-subtitle" class="text-slate-400"></p>
        </div>
        <div class="flex gap-3">
          <button
            onclick="deleteAllSeriesForAthlete()"
            class="p-3 bg-slate-800 hover:bg-slate-700 rounded-xl transition-all border border-red-600 text-red-400 hover:text-red-300"
            title="Alle Serien dieses Athleten l√∂schen"
          >
            üóëÔ∏è
          </button>
          <button
            onclick="openShootingInterface()"
            class="bg-indigo-600 hover:bg-indigo-700 px-6 py-3 rounded-xl font-bold shadow-lg transition-all"
          >
            Neue Serie
          </button>
        </div>
      </div>

      <div class="mb-6">
        <h2 class="text-xl font-bold mb-4">Schie√ü-Statistik</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div
            class="glass-card p-6 rounded-xl text-center hover:shadow-lg hover:shadow-purple-500/20"
          >
            <div
              class="text-3xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"
              id="stat-total-series"
            >
              0
            </div>
            <div class="text-xs text-slate-400 mt-2 font-medium">Anzahl Serien</div>
          </div>
          <div
            class="glass-card p-6 rounded-xl text-center hover:shadow-lg hover:shadow-green-500/20"
          >
            <div
              class="text-3xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent"
              id="stat-hit-rate"
            >
              0%
            </div>
            <div class="text-xs text-slate-400 mt-2 font-medium">Trefferquote</div>
          </div>
          <div
            class="glass-card p-6 rounded-xl text-center hover:shadow-lg hover:shadow-yellow-500/20"
          >
            <div
              class="text-3xl font-bold bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent"
              id="stat-avg-score"
            >
              0
            </div>
            <div class="text-xs text-slate-400 mt-2 font-medium">√ò Ringe</div>
          </div>
          <div
            class="glass-card p-6 rounded-xl text-center hover:shadow-lg hover:shadow-pink-500/20"
          >
            <div
              class="text-3xl font-bold bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent"
              id="stat-best-score"
            >
              0
            </div>
            <div class="text-xs text-slate-400 mt-2 font-medium">Gesamte Sch√ºsse</div>
          </div>
        </div>
      </div>

      <h2
        class="text-xl font-bold mb-4 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"
      >
        Serien-Historie
      </h2>

      <div id="athlete-history-list" class="space-y-4">
        <p class="text-center text-slate-500 py-10">Keine Serien vorhanden.</p>
      </div>
    </div>

    <!-- Einheit erstellen -->
    <div
      id="session-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-50"
    >
      <div
        class="bg-slate-800/95 w-full max-w-xl rounded-2xl p-6 border border-slate-700/50 shadow-2xl shadow-indigo-500/20 backdrop-blur-xl"
      >
        <h2
          class="text-2xl font-bold mb-6 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"
        >
          Trainingseinheit hinzuf√ºgen
        </h2>
        <form id="session-form" class="space-y-5">
          <div class="grid grid-cols-2 gap-4">
            <input
              type="text"
              id="s-ort"
              placeholder="Ort"
              required
              class="bg-slate-900/50 border border-slate-700/50 rounded-lg p-3 outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all backdrop-blur"
            />
            <input
              type="date"
              id="s-datum"
              required
              class="bg-slate-900/50 border border-slate-700/50 rounded-lg p-3 outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all backdrop-blur"
            />
          </div>
          <input
            type="text"
            id="s-zusatz"
            placeholder="Zusatz (z.B. DP Sprint)"
            class="w-full bg-slate-900/50 border border-slate-700/50 rounded-lg p-3 outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all backdrop-blur"
          />

          <div class="bg-slate-900/40 rounded-lg border border-slate-700/50 p-4 backdrop-blur">
            <div class="flex justify-between items-center mb-3">
              <label class="text-xs font-bold text-slate-400 uppercase">Athleten ausw√§hlen</label>
              <button
                type="button"
                onclick="toggleAllAthletes()"
                id="toggle-all-btn"
                class="text-xs font-semibold text-indigo-400 hover:text-indigo-300 transition-colors"
              >
                Alle ausw√§hlen
              </button>
            </div>
            <div
              id="athlete-checkboxes"
              class="grid grid-cols-2 gap-2 max-h-32 overflow-y-auto custom-scrollbar"
            ></div>
          </div>

          <div class="grid grid-cols-3 gap-2">
            <button
              type="button"
              onclick="setSType('Training')"
              id="s-btn-t"
              class="p-3 rounded-lg border border-slate-700/50 bg-slate-900/50 hover:border-indigo-500/50 hover:bg-indigo-600/20 transition-all backdrop-blur"
            >
              Training
            </button>
            <button
              type="button"
              onclick="setSType('Wettkampf')"
              id="s-btn-w"
              class="p-3 rounded-lg border border-slate-700/50 bg-slate-900/50 hover:border-indigo-500/50 hover:bg-indigo-600/20 transition-all backdrop-blur"
            >
              Wettkampf
            </button>
            <button
              type="button"
              onclick="setSType('Anschie√üen')"
              id="s-btn-a"
              class="p-3 rounded-lg border border-slate-700/50 bg-slate-900/50 hover:border-indigo-500/50 hover:bg-indigo-600/20 transition-all backdrop-blur"
            >
              Anschie√üen
            </button>
          </div>

          <div class="flex gap-3 pt-4">
            <button
              type="button"
              onclick="closeModal('session-modal')"
              class="flex-1 p-3 bg-slate-700/50 hover:bg-slate-700 rounded-lg font-bold transition-all backdrop-blur"
            >
              Abbrechen
            </button>
            <button
              type="button"
              onclick="submitSessionForm()"
              class="flex-1 p-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 rounded-lg font-bold transition-all"
            >
              Speichern
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Einstellungen -->
    <div
      id="settings-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-50"
    >
      <div
        class="bg-slate-800/95 w-full max-w-md rounded-2xl p-6 border border-slate-700/50 shadow-2xl shadow-indigo-500/20 max-h-[90vh] overflow-y-auto custom-scrollbar backdrop-blur-xl"
      >
        <h2
          class="text-2xl font-bold mb-6 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"
        >
          Einstellungen
        </h2>

        <!-- Athleten Auswahl -->
        <div class="mb-6 pb-6 border-b border-slate-700/50">
          <h3
            class="text-lg font-bold mb-3 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"
          >
            Athleten
          </h3>
          <div class="space-y-4">
            <div class="flex gap-2">
              <input
                type="text"
                id="new-athlete-name"
                placeholder="Athlet hinzuf√ºgen"
                class="flex-1 bg-slate-900/50 border border-slate-700/50 rounded-lg p-2 outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all backdrop-blur"
              />
              <button
                onclick="addGlobalAthlete()"
                class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 px-4 py-2 rounded-lg font-bold transition-all"
              >
                +
              </button>
            </div>
            <div
              id="global-athlete-list"
              class="space-y-2 max-h-48 overflow-y-auto custom-scrollbar pr-2"
            ></div>
          </div>
        </div>

        <!-- Email-Versand Sektion -->
        <div class="mb-6 pb-6 border-b border-slate-700/50">
          <h3
            class="text-lg font-bold mb-3 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"
          >
            Email-Empf√§nger
          </h3>
          <div class="space-y-4">
            <div class="flex gap-2">
              <input
                type="email"
                id="new-email-input"
                placeholder="Email hinzuf√ºgen (z.B. trainer@verein.de)"
                class="flex-1 bg-slate-900/50 border border-slate-700/50 rounded-lg p-2 outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all text-sm backdrop-blur"
              />
              <button
                onclick="addTrainerEmail()"
                class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 px-4 py-2 rounded-lg font-bold transition-all"
              >
                +
              </button>
            </div>
            <div
              id="email-list"
              class="space-y-2 max-h-48 overflow-y-auto custom-scrollbar pr-2"
            ></div>

            <label
              class="flex items-center gap-2 cursor-pointer hover:bg-slate-700/50 p-2 rounded transition-all"
            >
              <input
                type="checkbox"
                id="auto-send-checkbox"
                class="accent-indigo-500"
                onchange="saveEmailSettings()"
              />
              <span class="text-sm text-slate-300">Serien automatisch nach Beendigung senden</span>
            </label>

            <button
              onclick="sendTestEmail()"
              class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 px-4 py-2 rounded-lg font-semibold text-sm transition-all active:from-indigo-800 active:to-purple-800"
            >
              Test-Email senden
            </button>
          </div>
        </div>

        <!-- Ger√§te Typ -->
        <div class="mb-6 pb-6 border-b border-slate-700/50">
          <label for="device-type" class="block mb-2 text-sm font-medium text-slate-300"
            >Ger√§tetyp</label
          >
          <select
            id="device-type"
            class="w-full bg-slate-900/50 border border-slate-700/50 rounded-lg p-2 outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all backdrop-blur text-slate-100"
            onchange="saveDeviceType()"
          >
            <option value="auto">Automatisch erkennen</option>
            <option value="phone">Smartphone</option>
            <option value="tablet">Tablet</option>
            <option value="pc">Computer/PC</option>
          </select>
          <p class="text-xs text-slate-400 mt-2">
            W√§hlen Sie Ihr Ger√§t aus, um die UI optimal anzupassen.
          </p>
        </div>

        <!-- Scheiben Auswahl -->
        <div class="mb-6 pb-6 border-b border-slate-700/50">
          <label for="target-selection" class="block mb-2 text-sm font-medium text-slate-300"
            >Schie√üscheibe</label
          >
          <select
            id="target-selection"
            class="w-full bg-slate-900/50 border border-slate-700/50 rounded-lg p-2 outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all backdrop-blur text-slate-100"
            onchange="saveTargetSelection()"
          >
            <option value="scheibe1">Scheibe 1</option>
            <option value="scheibe2">Scheibe 2</option>
          </select>
          <p class="text-xs text-slate-400 mt-2">
            W√§hlen Sie die Schie√üscheibe aus, die Sie verwenden m√∂chten.
          </p>
        </div>

        <!-- Name -->
        <div class="mb-6 pb-6 border-b border-slate-700/50">
          <label for="trainer-name" class="block mb-2 text-sm font-medium text-slate-300"
            >Trainer Name</label
          >
          <input
            type="text"
            id="trainer-name"
            class="w-full bg-slate-900/50 border border-slate-700/50 rounded-lg p-2 outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all backdrop-blur"
          />
        </div>

        <!-- API Keys -->
        <div class="mb-6 pb-6 border-b border-slate-700/50">
          <h3
            class="text-lg font-bold mb-3 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"
          >
            EmailJS API Keys (F√ºr euch Irelevant)
          </h3>
          <div class="space-y-3">
            <div>
              <label for="api-public-key" class="block text-sm font-medium text-slate-400 mb-1"
                >Public Key</label
              >
              <input
                type="text"
                id="api-public-key"
                class="w-full bg-slate-900/50 border border-slate-700/50 rounded-lg p-2 text-sm outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all backdrop-blur"
                placeholder="Public Key eingeben..."
              />
            </div>
            <div>
              <label for="api-service-id" class="block text-sm font-medium text-slate-400 mb-1"
                >Service ID</label
              >
              <input
                type="text"
                id="api-service-id"
                class="w-full bg-slate-900/50 border border-slate-700/50 rounded-lg p-2 text-sm outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all backdrop-blur"
                placeholder="Service ID eingeben..."
              />
            </div>
            <div>
              <label for="api-template-id" class="block text-sm font-medium text-slate-400 mb-1"
                >Template ID</label
              >
              <input
                type="text"
                id="api-template-id"
                class="w-full bg-slate-900/50 border border-slate-700/50 rounded-lg p-2 text-sm outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all backdrop-blur"
                placeholder="Template ID eingeben..."
              />
            </div>
            <button
              onclick="resetApiKeysToDefault()"
              class="w-full bg-slate-700/50 hover:bg-slate-600/50 px-3 py-2 rounded-lg font-semibold text-sm transition-all backdrop-blur"
            >
              Auf Standard zur√ºcksetzen
            </button>
          </div>
        </div>

        <button
          onclick="closeModal('settings-modal')"
          class="w-full p-3 bg-slate-700/50 hover:bg-slate-600/50 rounded-lg font-bold transition-all backdrop-blur"
        >
          Schlie√üen
        </button>
      </div>
    </div>

    <!-- Einheits-Einstellungen Modal -->
    <div
      id="session-settings-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-50"
    >
      <div
        class="bg-slate-800/95 w-full max-w-md rounded-2xl p-6 border border-slate-700/50 shadow-2xl shadow-indigo-500/20 max-h-[90vh] overflow-y-auto custom-scrollbar backdrop-blur-xl"
      >
        <h2
          class="text-2xl font-bold mb-6 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"
        >
          Einheits-Einstellungen
        </h2>

        <!-- Athleten f√ºr diese Einheit -->
        <div class="mb-6 pb-6 border-b border-slate-700/50">
          <h3
            class="text-lg font-bold mb-3 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"
          >
            Athleten in dieser Einheit
          </h3>
          <div class="space-y-4">
            <div class="flex gap-2">
              <select
                id="session-athlete-select"
                class="flex-1 bg-slate-900/50 border border-slate-700/50 rounded-lg p-2 outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all text-sm backdrop-blur"
              >
                <option value="">-- Athlet ausw√§hlen --</option>
              </select>
              <button
                onclick="addSessionAthlete()"
                class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 px-4 py-2 rounded-lg font-bold transition-all"
              >
                +
              </button>
            </div>
            <div
              class="space-y-2 max-h-32 overflow-y-auto custom-scrollbar"
              id="session-athletes-list"
            ></div>
          </div>
        </div>

        <!-- Email-Versand Toggle -->
        <div class="mb-6 pb-6 border-b border-slate-700/50">
          <h3
            class="text-lg font-bold mb-3 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"
          >
            Email-Versand
          </h3>
          <label
            class="flex items-center gap-2 cursor-pointer hover:bg-slate-700/50 p-2 rounded transition-all"
          >
            <input
              type="checkbox"
              id="session-auto-send-checkbox"
              class="accent-indigo-500"
              onchange="saveSessionEmailSettings()"
            />
            <span class="text-sm text-slate-300">Serien automatisch nach Beendigung versenden</span>
          </label>
        </div>

        <!-- Email-Empf√§nger f√ºr diese Einheit -->
        <div class="mb-6 pb-6 border-b border-slate-700/50">
          <h3
            class="text-lg font-bold mb-3 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent"
          >
            Email-Empf√§nger
          </h3>
          <div class="space-y-4">
            <div class="flex gap-2">
              <input
                type="email"
                id="session-email-input"
                placeholder="Email hinzuf√ºgen"
                class="flex-1 bg-slate-900/50 border border-slate-700/50 rounded-lg p-2 outline-none focus:border-indigo-500 focus:bg-slate-900 transition-all text-sm backdrop-blur"
              />
              <button
                onclick="addSessionEmail()"
                class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 px-4 py-2 rounded-lg font-bold transition-all"
              >
                +
              </button>
            </div>
            <div
              id="session-email-list"
              class="space-y-2 max-h-48 overflow-y-auto custom-scrollbar pr-2"
            ></div>
          </div>
        </div>

        <button
          onclick="closeModal('session-settings-modal')"
          class="w-full p-3 bg-slate-700/50 hover:bg-slate-600/50 rounded-lg font-bold transition-all backdrop-blur"
        >
          Schlie√üen
        </button>
      </div>
    </div>

    <!-- Email-Auswahl Modal -->
    <div
      id="email-selection-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-50"
    >
      <div
        class="bg-slate-800/95 w-full max-w-md rounded-2xl p-6 border border-slate-700/50 shadow-2xl shadow-indigo-500/20 backdrop-blur-xl"
      >
        <h2 class="text-xl font-bold mb-6 text-white">Email-Adresse ausw√§hlen</h2>
        <div
          id="email-selection-list"
          class="space-y-2 mb-6 max-h-64 overflow-y-auto custom-scrollbar"
        ></div>
        <div class="flex gap-3">
          <button
            onclick="closeModal('email-selection-modal')"
            class="flex-1 p-3 bg-slate-700 rounded-lg font-bold"
          >
            Abbrechen
          </button>
        </div>
      </div>
    </div>

    <!-- Scheibe Gro√üansicht Modal -->
    <div
      id="target-fullscreen-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-[9999]"
    >
      <div class="w-full max-w-2xl bg-gray-800 rounded-xl shadow-2xl p-6 md:p-8">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold text-white">Schie√üscheibe</h2>
          <button
            onclick="closeModal('target-fullscreen-modal')"
            class="text-gray-400 hover:text-white text-3xl font-bold leading-none"
          >
            &times;
          </button>
        </div>
        <div
          id="fullscreen-target-container"
          class="rounded-full border-4 border-gray-700 max-w-lg mx-auto"
          style="aspect-ratio: 1 / 1"
        ></div>
      </div>
    </div>

    <!-- Serien hinzuf√ºgen -->
    <div
      id="shooting-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-50"
    >
      <div
        class="w-full max-w-2xl bg-gray-800 rounded-xl shadow-2xl p-6 md:p-8 max-h-[90vh] overflow-y-auto"
      >
        <div class="flex justify-end items-center mb-4">
          <button
            onclick="closeShootingInterface()"
            class="text-gray-400 hover:text-white text-3xl font-bold leading-none"
          >
            &times;
          </button>
        </div>

        <p id="shot-counter" class="text-lg font-semibold text-indigo-400 text-center mb-4">
          Sch√ºsse: 0 / 5
        </p>

        <div class="grid grid-cols-2 gap-2 mb-6">
          <button
            type="button"
            onclick="setPosition('Liegend')"
            id="pos-btn-prone"
            class="p-3 rounded-lg border-2 border-indigo-500 bg-indigo-500/20 font-bold text-white"
          >
            Liegend
          </button>
          <button
            type="button"
            onclick="setPosition('Stehend')"
            id="pos-btn-standing"
            class="p-3 rounded-lg border border-slate-700 bg-slate-900 text-slate-400"
          >
            Stehend
          </button>
        </div>

        <div id="target-container">
          <svg
            id="biathlon-target"
            viewBox="0 0 200 200"
            class="w-full h-full"
            style="background-color: #f3f4f6; border-radius: 50%"
          >
            <style>
              .ring-number-white {
                font-size: 4px;
                fill: white;
                text-anchor: middle;
                dominant-baseline: central;
              }

              .ring-number-black {
                font-size: 4px;
                fill: #000;
                text-anchor: middle;
                dominant-baseline: central;
              }
            </style>

            <circle cx="100" cy="100" r="100" fill="white" stroke="#000"></circle>
            <text x="195" y="100" class="ring-number-black" text-anchor="end">1</text>
            <text x="5" y="100" class="ring-number-black" text-anchor="start">1</text>
            <text x="100" y="5" class="ring-number-black">1</text>
            <text x="100" y="195" class="ring-number-black">1</text>

            <circle cx="100" cy="100" r="90" fill="white" stroke="#000"></circle>
            <text x="185" y="100" class="ring-number-black" text-anchor="end">2</text>
            <text x="15" y="100" class="ring-number-black" text-anchor="start">2</text>
            <text x="100" y="15" class="ring-number-black">2</text>
            <text x="100" y="185" class="ring-number-black">2</text>

            <circle cx="100" cy="100" r="80" fill="white" stroke="#000"></circle>
            <text x="175" y="100" class="ring-number-black" text-anchor="end">3</text>
            <text x="25" y="100" class="ring-number-black" text-anchor="start">3</text>
            <text x="100" y="25" class="ring-number-black">3</text>
            <text x="100" y="175" class="ring-number-black">3</text>

            <circle cx="100" cy="100" r="70" fill="#000" stroke="white"></circle>
            <text x="165" y="100" class="ring-number-white" text-anchor="end">4</text>
            <text x="35" y="100" class="ring-number-white" text-anchor="start">4</text>
            <text x="100" y="35" class="ring-number-white">4</text>
            <text x="100" y="165" class="ring-number-white">4</text>

            <circle cx="100" cy="100" r="60" fill="#000" stroke="white"></circle>
            <text x="155" y="100" class="ring-number-white" text-anchor="end">5</text>
            <text x="45" y="100" class="ring-number-white" text-anchor="start">5</text>
            <text x="100" y="45" class="ring-number-white">5</text>
            <text x="100" y="155" class="ring-number-white">5</text>

            <circle cx="100" cy="100" r="50" fill="#000" stroke="white"></circle>
            <text x="145" y="100" class="ring-number-white" text-anchor="end">6</text>
            <text x="55" y="100" class="ring-number-white" text-anchor="start">6</text>
            <text x="100" y="55" class="ring-number-white">6</text>
            <text x="100" y="145" class="ring-number-white">6</text>

            <circle cx="100" cy="100" r="40" fill="#000" stroke="white"></circle>
            <text x="135" y="100" class="ring-number-white" text-anchor="end">7</text>
            <text x="65" y="100" class="ring-number-white" text-anchor="start">7</text>
            <text x="100" y="65" class="ring-number-white">7</text>
            <text x="100" y="135" class="ring-number-white">7</text>

            <circle cx="100" cy="100" r="30" fill="#000" stroke="white" stroke-width="3"></circle>
            <text x="125" y="100" class="ring-number-white" text-anchor="end">8</text>
            <text x="75" y="100" class="ring-number-white" text-anchor="start">8</text>
            <text x="100" y="75" class="ring-number-white">8</text>
            <text x="100" y="125" class="ring-number-white">8</text>

            <circle cx="100" cy="100" r="20" fill="#000" stroke="white"></circle>

            <circle cx="100" cy="100" r="10" fill="#000" stroke="white"></circle>

            <circle cx="100" cy="100" r="2" fill="white" stroke="none"></circle>
          </svg>
        </div>

        <p id="status-message" class="text-gray-400 mb-6 transition duration-300 text-center mt-4">
          [Ring], [Richtung] oder auf die Scheibe klicken.
        </p>

        <!-- Arrow Buttons for Correction Adjustment -->
        <div class="flex justify-center gap-2 mt-4 mb-4 items-center">
          <button
            onclick="window.adjustCorrectionUp()"
            class="px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition duration-200 text-lg font-bold"
            title="Korrektur nach oben"
          >
            ‚ñ≤
          </button>
          <button
            onclick="window.adjustCorrectionDown()"
            class="px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition duration-200 text-lg font-bold"
            title="Korrektur nach unten"
          >
            ‚ñº
          </button>
          <button
            onclick="window.adjustCorrectionLeft()"
            class="px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition duration-200 text-lg font-bold"
            title="Korrektur nach links"
          >
            ‚óÑ
          </button>
          <button
            onclick="window.adjustCorrectionRight()"
            class="px-3 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded transition duration-200 text-lg font-bold"
            title="Korrektur nach rechts"
          >
            ‚ñ∫
          </button>

          <div class="flex flex-col items-center ml-4">
            <label
              for="adjustment-toggle"
              class="text-sm font-semibold text-gray-400 mb-1 whitespace-nowrap"
              >Pfeile</label
            >
            <label class="switch">
              <input type="checkbox" id="adjustment-toggle" onchange="window.toggleAdjustment()" />
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <div class="mt-8 flex justify-center space-x-4 items-center flex-wrap gap-3">
          <button
            id="toggle-button"
            class="flex items-center space-x-2 py-3 px-6 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105"
            onclick="toggleSpeech()"
          >
            <span id="button-text">Start Aufnahme</span>
          </button>

          <button
            onclick="window.finishSeries()"
            class="py-3 px-6 border border-gray-600 text-gray-400 font-semibold rounded-full shadow-lg transition duration-300 hover:bg-gray-700 hover:text-white transform hover:scale-105"
          >
            Neue Serie
          </button>

          <button
            onclick="window.undoLastShot()"
            class="py-3 px-6 border border-gray-600 text-gray-400 font-semibold rounded-full shadow-lg transition duration-300 hover:bg-gray-700 hover:text-white transform hover:scale-105"
          >
            Zur√ºck
          </button>

          <div class="flex flex-col items-center ml-4">
            <label
              for="correction-toggle"
              class="text-sm font-semibold text-gray-400 mb-1 whitespace-nowrap"
              >Korrektur</label
            >
            <label class="switch">
              <input type="checkbox" id="correction-toggle" onchange="window.toggleCorrection()" />
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <!-- Transcription Target - Collapsible at bottom -->
        <div class="mt-8 w-full">
          <div class="flex justify-center mb-2">
            <button
              onclick="window.toggleTranscriptionView()"
              class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white text-sm rounded transition duration-200"
              id="transcription-toggle-btn"
            >
              Sprachausgabe anzeigen ‚ñº
            </button>
          </div>
          <div id="transcription-container" class="hidden">
            <div
              id="transcription-target"
              contenteditable="true"
              class="w-full border-2 border-gray-700 bg-gray-900 text-gray-200 p-4 rounded-lg focus:outline-none focus:border-indigo-500 transition duration-300 min-h-[40px] max-h-[200px] overflow-y-auto"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Geschichte Viewer Modal - Athletenliste -->
    <div
      id="history-viewer-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-50"
    >
      <div
        class="bg-slate-800 w-full max-w-4xl rounded-2xl p-6 border border-slate-700 shadow-2xl max-h-[90vh] overflow-y-auto custom-scrollbar"
      >
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-white">Alle Athleten & Serien</h2>
          <button
            onclick="closeModal('history-viewer-modal')"
            class="text-gray-400 hover:text-white text-3xl font-bold leading-none"
          >
            &times;
          </button>
        </div>

        <div id="history-athletes-list" class="grid gap-3">
          <p class="text-center text-slate-500 py-10">Keine Athleten vorhanden.</p>
        </div>
      </div>
    </div>

    <!-- Geschichte Viewer Modal - Serien Details -->
    <div
      id="history-detail-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center p-4 z-50"
    >
      <div
        class="bg-slate-800 w-full max-w-4xl rounded-2xl p-6 border border-slate-700 shadow-2xl max-h-[90vh] overflow-y-auto custom-scrollbar"
      >
        <div class="flex items-center gap-4 mb-6">
          <button
            onclick="backToHistoryAthletes()"
            class="p-2 hover:bg-slate-700 rounded-full transition-all"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 text-indigo-400"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              />
            </svg>
          </button>
          <div class="flex-1">
            <h2 id="history-detail-athlete-name" class="text-2xl font-bold text-white">
              Athlet Name
            </h2>
            <p id="history-detail-stats" class="text-slate-400 text-sm mt-1"></p>
          </div>
          <button
            onclick="closeModal('history-detail-modal')"
            class="text-gray-400 hover:text-white text-3xl font-bold leading-none"
          >
            &times;
          </button>
        </div>

        <!-- Suchbereich -->
        <div class="mb-6 p-4 bg-slate-900 rounded-lg border border-slate-700">
          <h3 class="text-sm font-bold text-slate-400 mb-3">Filter & Suche</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <input
              type="date"
              id="history-filter-date"
              placeholder="Nach Datum filtern"
              class="bg-slate-800 border border-slate-700 rounded-lg p-2 outline-none focus:border-indigo-500 text-sm"
            />
            <select
              id="history-filter-type"
              class="bg-slate-800 border border-slate-700 rounded-lg p-2 outline-none focus:border-indigo-500 text-sm"
            >
              <option value="">-- Alle Trainingstypen --</option>
              <option value="Training">Training</option>
              <option value="Wettkampf">Wettkampf</option>
              <option value="Anschie√üen">Anschie√üen</option>
            </select>
            <button
              onclick="filterHistorySeries()"
              class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-lg font-semibold text-sm transition-all"
            >
              Filtern
            </button>
          </div>
        </div>

        <!-- Statistiken -->
        <div class="mb-6">
          <h3 class="text-lg font-bold mb-3">Allgemeine Statistiken</h3>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <div class="glass-card p-4 rounded-xl text-center">
              <div class="text-2xl font-bold text-indigo-400" id="history-stat-total-series">0</div>
              <div class="text-xs text-slate-400 mt-1">Serien gesamt</div>
            </div>
            <div class="glass-card p-4 rounded-xl text-center">
              <div class="text-2xl font-bold text-green-400" id="history-stat-hit-rate">0%</div>
              <div class="text-xs text-slate-400 mt-1">Schie√üquote</div>
            </div>
            <div class="glass-card p-4 rounded-xl text-center">
              <div class="text-2xl font-bold text-yellow-400" id="history-stat-avg-score">0</div>
              <div class="text-xs text-slate-400 mt-1">√ò Ringe</div>
            </div>
            <div class="glass-card p-4 rounded-xl text-center">
              <div class="text-2xl font-bold text-purple-400" id="history-stat-total-shots">0</div>
              <div class="text-xs text-slate-400 mt-1">Sch√ºsse</div>
            </div>
          </div>
        </div>

        <!-- Serien Liste -->
        <h3 class="text-lg font-bold mb-3">Serien</h3>
        <div id="history-series-list" class="space-y-3">
          <p class="text-center text-slate-500 py-10">Keine Serien vorhanden.</p>
        </div>
      </div>
    </div>

    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css" />

    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <!-- App Scripts (in dieser Reihenfolge!) -->
    <script src="js/constants.js"></script>
    <script src="js/modules/storage.js"></script>
    <script src="js/modules/athletes.js"></script>
    <script src="js/modules/sessions.js"></script>
    <script src="js/modules/shooting.js"></script>
    <script src="js/modules/speech.js"></script>
    <script src="js/modules/email.js"></script>
    <script src="js/modules/ui.js"></script>
    <script src="js/modules/utils.js"></script>
    <script src="js/services/imageGenerator.js"></script>
    <script src="js/services/app.js"></script>
  </body>
</html>
