<!--
MIT License

Copyright (c) 2026 jmfrohs

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
      name="viewport"
    />
    <title>Session Details - Biathlon Shot Logger</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="apple-touch-icon" href="assets/images/app-icon.png" />
    <meta name="theme-color" content="#0f172a" />

    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/global.css" />
    <script src="js/core/config.js"></script>
    <script src="js/core/theme-manager.js"></script>

    <!-- Export Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: '#007AFF',
              'deep-charcoal': 'var(--color-bg)',
              'card-dark': 'var(--color-card)',
              'neon-green': '#32D74B',
              'neon-red': '#FF453A',
              'neon-cyan': '#64D2FF',
              'off-white': 'var(--color-text)',
              'light-blue-info': '#8E8E93',
              'border-subtle': 'var(--color-border)',
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
          },
        },
      };
    </script>
  </head>

  <body class="text-off-white min-h-screen flex justify-center items-center bg-deep-charcoal">
    <div
      id="app-container"
      class="w-full max-w-[430px] h-[932px] bg-deep-charcoal relative overflow-hidden flex flex-col shadow-2xl md:rounded-[55px] md:border-8 md:border-zinc-800"
    >
      <header class="px-6 pt-8 pb-6">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <a href="index.html" class="p-2 -ml-2 text-off-white/70 active:scale-90 transition-all">
              <span class="material-symbols-outlined text-[28px]">arrow_back_ios_new</span>
            </a>
            <div class="space-y-0.5">
              <h1
                id="sessionTitle"
                class="text-2xl font-bold tracking-tight text-off-white"
                data-i18n="session_detail"
              >
                Session Detail
              </h1>
              <p
                id="sessionSubtitle"
                class="text-[11px] font-bold text-light-blue-info/60 uppercase tracking-[0.15em]"
                data-i18n="loading"
              >
                Loading...
              </p>
            </div>
          </div>
          <button
            id="openSettingsBtn"
            class="w-10 h-10 flex items-center justify-center rounded-full bg-card-dark border border-subtle text-off-white/70 active:scale-95 transition-all"
          >
            <span class="material-symbols-outlined text-[24px]">more_vert</span>
          </button>
        </div>
      </header>

      <div class="px-6 py-2">
        <div id="filterButtons" class="flex gap-3 overflow-x-auto pb-4 no-scrollbar -mx-1 px-1">
          <!-- Filter buttons will be dynamically added here -->
        </div>
      </div>

      <main class="flex-1 overflow-y-auto px-6 py-2 no-scrollbar">
        <div id="athletesList" class="space-y-4">
          <!-- Athletes will be rendered here -->
        </div>
      </main>

      <!-- Settings Modal -->
      <div
        id="settingsModal"
        class="hidden fixed inset-0 bg-black/80 backdrop-blur-md flex items-end justify-center z-50"
      >
        <div
          class="bg-card-dark rounded-t-[40px] w-full max-w-[430px] p-6 pb-12 border-t border-subtle shadow-2xl flex flex-col gap-8 animate-in slide-in-from-bottom duration-300"
        >
          <div class="flex justify-between items-center">
            <h2 class="text-xl font-bold text-off-white" data-i18n="session_settings">
              Session Settings
            </h2>
            <button
              id="closeSettingsBtn"
              class="w-10 h-10 flex items-center justify-center rounded-full bg-white/5 text-off-white/50 active:scale-90 transition-all"
            >
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>

          <!-- Email Reporting -->
          <section>
            <div class="flex items-center gap-2 mb-4 px-1">
              <span
                class="text-[11px] font-black uppercase tracking-[0.2em] text-light-blue-info/70"
                data-i18n="reporting"
                >Reporting</span
              >
            </div>
            <div class="bg-deep-charcoal/50 rounded-[24px] border border-subtle overflow-hidden">
              <div class="p-4 flex items-center justify-between border-b border-subtle/30">
                <div class="flex items-center gap-4">
                  <div
                    class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center"
                  >
                    <span class="material-symbols-outlined text-primary">mail</span>
                  </div>
                  <div>
                    <h3 class="font-bold text-sm" data-i18n="email_report">Email Report</h3>
                    <p class="text-[11px] text-light-blue-info/70" data-i18n="send_summary">
                      Send summary after session
                    </p>
                  </div>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" id="emailReporting" class="sr-only peer" />
                  <div
                    class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"
                  ></div>
                </label>
              </div>
              <!-- Recipient Selection List -->
              <div
                id="recipientSelectionContainer"
                class="hidden p-4 bg-off-white/5 border-t border-subtle/20"
              >
                <p
                  class="text-[10px] font-bold text-light-blue-info uppercase tracking-wider mb-2"
                  data-i18n="select_recipients"
                >
                  Select Recipients
                </p>
                <div id="sessionRecipientsList" class="space-y-2">
                  <!-- Recipient checkboxes injected via JS -->
                </div>
              </div>
              <!-- Auto Save Series Toggle -->
              <div
                class="p-4 flex items-center justify-between border-t border-subtle/30 cursor-pointer active:bg-off-white/5 transition-colors"
                onclick="document.getElementById('autoSaveSeries').click()"
              >
                <div class="flex items-center gap-4">
                  <div
                    class="w-10 h-10 rounded-full bg-neon-cyan/10 flex items-center justify-center"
                  >
                    <span class="material-symbols-outlined text-neon-cyan">sync</span>
                  </div>
                  <div>
                    <h3 class="font-bold text-sm" data-i18n="auto_save">Auto-Save Sessions</h3>
                    <p class="text-[11px] text-light-blue-info/70" data-i18n="auto_save_desc">
                      Save automatically after 5 shots
                    </p>
                  </div>
                </div>
                <label
                  class="relative inline-flex items-center cursor-pointer"
                  onclick="event.stopPropagation()"
                >
                  <input type="checkbox" id="autoSaveSeries" class="sr-only peer" />
                  <div
                    class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"
                  ></div>
                </label>
              </div>
            </div>
          </section>

          <!-- Participation Management -->
          <section>
            <div class="flex items-center justify-between mb-4 px-1">
              <span
                class="text-[11px] font-black uppercase tracking-[0.2em] text-light-blue-info/70"
                data-i18n="participation"
                >Participation</span
              >
              <button
                id="addMoreAthletesBtn"
                class="text-[11px] font-bold text-primary uppercase tracking-wider"
                data-i18n="add_remove"
              >
                Add/Remove
              </button>
            </div>
            <div
              id="miniAthletesList"
              class="flex gap-2 overflow-x-auto pb-1 no-scrollbar -mx-1 px-1"
            >
              <!-- Mini avatars of current participants -->
            </div>
          </section>

          <!-- Export Section -->
          <section>
            <div class="flex items-center gap-2 mb-4 px-1">
              <span
                class="text-[11px] font-black uppercase tracking-[0.2em] text-light-blue-info/70"
                data-i18n="export_session"
                >Export Session</span
              >
            </div>
            <div class="grid grid-cols-2 gap-3">
              <button
                id="exportPdfBtn"
                class="flex flex-col items-center justify-center gap-2 p-4 bg-primary/10 border border-primary/20 rounded-2xl active:scale-[0.98] transition-all group"
              >
                <div
                  class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center group-active:scale-90 transition-transform"
                >
                  <span class="material-symbols-outlined text-primary">picture_as_pdf</span>
                </div>
                <span class="text-[10px] font-black uppercase tracking-wider text-primary"
                  >PDF Export</span
                >
              </button>
              <button
                id="exportExcelBtn"
                class="flex flex-col items-center justify-center gap-2 p-4 bg-neon-green/10 border border-neon-green/20 rounded-2xl active:scale-[0.98] transition-all group"
              >
                <div
                  class="w-10 h-10 rounded-full bg-neon-green/20 flex items-center justify-center group-active:scale-90 transition-transform"
                >
                  <span class="material-symbols-outlined text-neon-green">table_view</span>
                </div>
                <span class="text-[10px] font-black uppercase tracking-wider text-neon-green"
                  >Excel Export</span
                >
              </button>
            </div>
          </section>

          <!-- Danger Zone -->
          <button
            id="deleteSessionBtn"
            class="w-full p-4 rounded-2xl bg-red-500/10 border border-red-500/20 text-red-500 font-bold text-sm active:scale-[0.98] transition-all flex items-center justify-center gap-2"
          >
            <span class="material-symbols-outlined text-lg">delete</span>
            <span data-i18n="delete_session">Delete Session</span>
          </button>
        </div>
      </div>

      <!-- Sub-Modal for Athlete Selection -->
      <div
        id="athletesModal"
        class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[60]"
      >
        <div
          class="bg-card-dark rounded-[32px] p-6 w-[92%] max-h-[80vh] flex flex-col border border-subtle shadow-2xl space-y-4"
        >
          <div class="flex justify-between items-center">
            <h2 class="text-xl font-bold text-off-white" data-i18n="select_athletes">
              Select Athletes
            </h2>
            <button
              id="closeSelectionBtn"
              class="w-10 h-10 flex items-center justify-center rounded-full bg-white/5 text-off-white/50"
            >
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>
          <div
            id="athletesSelectList"
            class="flex-1 overflow-y-auto space-y-2 no-scrollbar py-1"
          ></div>
          <button
            id="confirmSelectionBtn"
            class="w-full px-6 py-4 bg-primary text-white font-bold rounded-2xl active:scale-95 transition-all shadow-lg shadow-primary/20"
            data-i18n="update_list_btn"
          >
            Update List
          </button>
        </div>
      </div>

      <!-- Target Preview Modal -->
      <div
        id="targetPreviewModal"
        class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[70] p-4"
      >
        <div
          class="bg-card-dark w-full max-w-lg rounded-[32px] border border-subtle shadow-2xl p-6 flex flex-col items-center relative animate-in zoom-in duration-300"
        >
          <div class="flex justify-between items-center w-full mb-2">
            <h1 class="text-xl font-bold text-off-white" data-i18n="target_analysis">
              Treffbild Analyse
            </h1>
            <button
              id="closeTargetPreviewBtn"
              class="w-10 h-10 flex items-center justify-center rounded-full bg-white/5 text-off-white/70 active:scale-90 transition-all border border-subtle/20 hover:bg-white/10"
            >
              <span class="material-symbols-outlined text-[20px]">close</span>
            </button>
          </div>

          <div
            id="largeTargetContainer"
            class="w-full aspect-square bg-white rounded-full shadow-inner p-1 flex items-center justify-center border-4 border-white/5 my-4"
          >
            <!-- Large Target SVG will be injected here -->
          </div>

          <div class="w-full flex justify-center">
            <button
              id="modalEditSeriesBtn"
              class="w-full flex items-center justify-center gap-2 px-6 py-3 bg-primary text-white font-bold rounded-2xl active:scale-95 transition-all shadow-lg shadow-primary/20"
            >
              <span class="material-symbols-outlined">edit</span>
              <span data-i18n="edit_series">Serie bearbeiten</span>
            </button>
          </div>
        </div>
      </div>

      <script src="js/core/lang.js"></script>
      <script src="js/utils/utils.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          translateApp();
        });
      </script>
      <script src="js/managers/target-manager.js"></script>
      <script src="js/core/constants.js"></script>
      <script src="js/pages/session-detail.js"></script>
    </div>
  </body>
</html>
