<!--
MIT License

Copyright (c) 2026 jmfrohs

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
      name="viewport"
    />
    <title>Analytics - Biathlon Shooting Assistant</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="apple-touch-icon" href="assets/images/app-icon.png" />
    <meta name="theme-color" content="#0f172a" />

    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <script src="js/core/theme-manager.js"></script>
    <!-- Export Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/global.css" />
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: '#007AFF',
              'deep-charcoal': 'var(--color-bg)',
              'card-dark': 'var(--color-card)',
              'neon-green': '#39FF14',
              'neon-cyan': '#00F0FF',
              'off-white': 'var(--color-text)',
              'light-blue-info': '#8E8E93',
              'border-subtle': 'var(--color-border)',
            },
            fontFamily: {
              display: ['Inter', 'sans-serif'],
            },
            borderRadius: {
              DEFAULT: '14px',
              xl: '16px',
              '2xl': '20px',
            },
            borderWidth: {
              8: '8px',
            },
          },
        },
      };

      function navigateTo(url) {
        window.location.href = url;
      }
    </script>
  </head>

  <body
    class="text-off-white min-h-screen flex justify-center items-center bg-deep-charcoal transition-colors"
  >
    <div
      id="app-container"
      class="w-full max-w-[430px] h-[932px] bg-deep-charcoal relative overflow-hidden flex flex-col shadow-2xl md:rounded-[55px] md:border-[8px] md:border-zinc-800"
    >
      <!-- Header -->
      <div
        class="status-bar px-8 pt-6 pb-2 flex justify-between items-center text-base font-semibold text-off-white"
      ></div>
      <header class="px-6 pt-2 pb-6">
        <div class="flex items-center gap-4">
          <button
            id="analytics-back"
            class="hidden p-2 -ml-2 text-off-white/70 active:scale-90 transition-all flex items-center justify-center"
          >
            <span class="material-symbols-outlined text-[28px]">arrow_back_ios_new</span>
          </button>
          <div class="space-y-1">
            <h1
              id="analytics-title"
              class="text-3xl font-bold tracking-tight text-off-white"
              data-i18n="analytics"
            >
              Analytics
            </h1>
            <p class="text-sm text-light-blue-info font-medium" data-i18n="performance_insights">
              Performance Insights & Stats
            </p>
          </div>
        </div>
      </header>

      <main class="flex-1 overflow-y-auto px-6 py-4 space-y-4 no-scrollbar">
        <!-- Collapsible Analysis Section -->
        <section class="space-y-2">
          <div
            onclick="toggleAnalysis()"
            class="bg-primary/10 border border-primary/20 rounded-2xl p-4 flex justify-between items-center cursor-pointer active:opacity-80 transition-opacity"
          >
            <div class="flex items-center gap-3">
              <span class="material-symbols-outlined text-primary">insights</span>
              <span class="text-primary font-bold" data-i18n="analysis_insights"
                >Analysis & Insights</span
              >
            </div>
            <span
              id="analysis-chevron"
              class="material-symbols-outlined text-primary transition-transform duration-200"
              >expand_more</span
            >
          </div>

          <div id="analysis-content" class="hidden space-y-4 pt-2">
            <!-- Stats Grid -->
            <div class="grid grid-cols-2 gap-3">
              <div
                class="bg-card-dark p-4 rounded-2xl border border-subtle flex flex-col items-center justify-center shadow-sm"
              >
                <div class="text-2xl font-black text-off-white" id="stat-total-series">0</div>
                <div
                  class="text-[10px] uppercase font-bold text-zinc-500 tracking-wider mt-1"
                  data-i18n="series"
                >
                  Series
                </div>
              </div>
              <div
                class="bg-card-dark p-4 rounded-2xl border border-subtle flex flex-col items-center justify-center shadow-sm"
              >
                <div class="text-2xl font-black text-neon-green" id="stat-hit-rate">0%</div>
                <div
                  class="text-[10px] uppercase font-bold text-zinc-500 tracking-wider mt-1"
                  data-i18n="hit_rate"
                >
                  Hit Rate
                </div>
              </div>
              <div
                class="bg-card-dark p-4 rounded-2xl border border-subtle flex flex-col items-center justify-center shadow-sm"
              >
                <div class="text-2xl font-black text-yellow-400" id="stat-avg-rings">0.0</div>
                <div
                  class="text-[10px] uppercase font-bold text-zinc-500 tracking-wider mt-1"
                  data-i18n="avg_rings"
                >
                  Ã˜ Rings
                </div>
              </div>
              <div
                class="bg-card-dark p-4 rounded-2xl border border-subtle flex flex-col items-center justify-center shadow-sm"
              >
                <div class="text-2xl font-black text-primary" id="stat-total-shots">0</div>
                <div
                  class="text-[10px] uppercase font-bold text-zinc-500 tracking-wider mt-1"
                  data-i18n="shots_count"
                >
                  Shots
                </div>
              </div>
            </div>

            <!-- Heatmap Card -->
            <div class="bg-card-dark rounded-2xl border border-subtle overflow-hidden shadow-lg">
              <div
                class="px-4 py-3 border-b border-subtle bg-off-white/5 flex justify-between items-center"
              >
                <span
                  class="text-xs font-bold text-zinc-400 uppercase tracking-widest"
                  data-i18n="shot_distribution"
                  >Shot Distribution</span
                >
                <span
                  class="text-xs text-primary bg-primary/20 px-2 py-0.5 rounded-full font-bold"
                  data-i18n="heatmap"
                  >Heatmap</span
                >
              </div>
              <div class="p-6 flex justify-center">
                <div
                  id="heatmap-container"
                  class="w-64 h-64 relative cursor-pointer active:scale-95 transition-transform hover:opacity-90"
                >
                  <!-- Heatmap SVG injected here -->
                </div>
              </div>
            </div>

            <!-- Total Placements Card (New) -->
            <div class="bg-card-dark rounded-2xl border border-subtle overflow-hidden shadow-lg">
              <div
                class="px-4 py-3 border-b border-subtle bg-off-white/5 flex justify-between items-center"
              >
                <span
                  class="text-xs font-bold text-zinc-400 uppercase tracking-widest"
                  data-i18n="combined_accuracy"
                  >Combined Accuracy</span
                >
                <span
                  class="text-xs text-green-500 bg-green-500/20 px-2 py-0.5 rounded-full font-bold"
                  data-i18n="all_shots"
                  >All Shots</span
                >
              </div>
              <div class="p-6 flex justify-center">
                <div
                  id="total-placements-container"
                  class="w-64 h-64 relative cursor-pointer active:scale-95 transition-transform hover:opacity-90"
                >
                  <!-- Total Placements SVG injected here -->
                </div>
              </div>
            </div>

            <!-- Performance Trend Card (New) -->
            <div class="bg-card-dark rounded-2xl border border-subtle overflow-hidden shadow-lg">
              <div
                class="px-4 py-3 border-b border-subtle bg-off-white/5 flex justify-between items-center"
              >
                <span
                  class="text-xs font-bold text-zinc-400 uppercase tracking-widest"
                  data-i18n="performance_trend"
                  >Performance Trend</span
                >
                <span
                  class="text-xs text-primary bg-primary/20 px-2 py-0.5 rounded-full font-bold"
                  data-i18n="hit_rate_over_time"
                  >Hit Rate %</span
                >
              </div>
              <div class="p-4 flex justify-center">
                <div
                  id="trend-chart-container"
                  class="w-full h-48 relative cursor-pointer active:scale-95 transition-transform hover:opacity-90"
                >
                  <!-- Trend Chart SVG injected here -->
                </div>
              </div>
            </div>

            <p
              class="text-sm text-zinc-500 text-center leading-relaxed px-4 pt-2"
              data-i18n="analytics_description"
            >
              Comprehensive overview of shooting performance, combining heatmaps for density
              analysis and target overlays for exact grouping visualization.
            </p>
          </div>
        </section>

        <!-- Main Drill-down Content -->
        <div id="analytics-content" class="pb-10">
          <!-- List items injected via JS (Athletes -> Sessions -> Series) -->
        </div>
      </main>

      <!-- Target Preview Modal -->
      <div
        id="targetPreviewModal"
        class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[70] p-4"
      >
        <div
          class="bg-card-dark w-full max-w-lg rounded-[32px] border border-subtle shadow-2xl p-6 flex flex-col items-center relative animate-in zoom-in duration-300"
        >
          <div class="flex justify-between items-center w-full mb-2">
            <h1 class="text-xl font-bold text-off-white" data-i18n="target_analysis">
              Treffbild Analyse
            </h1>
            <button
              id="closeTargetPreviewBtn"
              class="w-10 h-10 flex items-center justify-center rounded-full bg-white/5 text-off-white/70 active:scale-90 transition-all border border-subtle/20 hover:bg-white/10"
            >
              <span class="material-symbols-outlined text-[20px]">close</span>
            </button>
          </div>

          <div
            id="largeTargetContainer"
            class="w-full aspect-square bg-white rounded-full shadow-inner p-1 flex items-center justify-center border-4 border-white/5 my-4"
          >
            <!-- Large Target SVG will be injected here -->
          </div>

          <div class="w-full flex justify-center">
            <button
              id="modalEditSeriesBtn"
              class="w-full flex items-center justify-center gap-2 px-6 py-3 bg-primary text-white font-bold rounded-2xl active:scale-95 transition-all shadow-lg shadow-primary/20"
            >
              <span class="material-symbols-outlined">edit</span>
              <span data-i18n="edit_series">Serie bearbeiten</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Home Indicator -->
      <div
        class="absolute bottom-2 left-1/2 -translate-x-1/2 w-36 h-1.5 bg-off-white/30 rounded-full z-50"
      ></div>

      <nav
        id="bottom-nav"
        class="bg-card-dark/90 ios-blur border-t border-subtle px-6 pt-4 pb-10 flex justify-around items-center z-40"
      >
        <a
          href="athletes.html"
          id="nav-athletes"
          class="flex flex-col items-center gap-1.5 text-light-blue-info flex-1 touch-target active:opacity-60"
        >
          <span class="material-symbols-outlined text-[30px]">groups</span>
          <span class="text-[11px] font-semibold">Athletes</span>
        </a>
        <a
          href="index.html"
          id="nav-sessions"
          class="flex flex-col items-center gap-1.5 text-light-blue-info flex-1 touch-target active:opacity-60"
        >
          <span class="material-symbols-outlined text-[30px]">event_note</span>
          <span class="text-[11px] font-semibold">Sessions</span>
        </a>
        <a
          href="analytics.html"
          id="nav-analytics"
          class="flex flex-col items-center gap-1.5 text-primary flex-1 touch-target active:opacity-60"
        >
          <span
            class="material-symbols-outlined text-[30px]"
            style="font-variation-settings: 'FILL' 1"
            >analytics</span
          >
          <span class="text-[11px] font-bold">Analytics</span>
        </a>
        <a
          href="settings.html"
          id="nav-settings"
          class="flex flex-col items-center gap-1.5 text-light-blue-info flex-1 touch-target active:opacity-60"
        >
          <span class="material-symbols-outlined text-[30px]">settings</span>
          <span class="text-[11px] font-semibold">Settings</span>
        </a>
      </nav>

      <script src="js/core/lang.js"></script>
      <script src="js/utils/utils.js"></script>
      <script>
        function toggleAnalysis() {
          const content = document.getElementById('analysis-content');
          const chevron = document.getElementById('analysis-chevron');
          const isHidden = content.classList.contains('hidden');

          if (isHidden) {
            content.classList.remove('hidden');
            chevron.style.transform = 'rotate(180deg)';
          } else {
            content.classList.add('hidden');
            chevron.style.transform = 'rotate(0deg)';
          }
        }

        (function () {
          // Navigation
          const athletesBtn = document.getElementById('nav-athletes');
          if (athletesBtn) athletesBtn.addEventListener('click', () => navigateTo('athletes.html'));

          const sessionsBtn = document.getElementById('nav-sessions');
          if (sessionsBtn) sessionsBtn.addEventListener('click', () => navigateTo('index.html'));

          const analyticsBtn = document.getElementById('nav-analytics');
          if (analyticsBtn)
            analyticsBtn.addEventListener('click', () => navigateTo('analytics.html'));

          const settingsBtn = document.getElementById('nav-settings');
          if (settingsBtn) settingsBtn.addEventListener('click', () => navigateTo('settings.html'));

          // Initialize Analytics handled by js/analytics.js
          translateApp();
        })();
      </script>
    </div>
    <script src="js/managers/target-manager.js"></script>
    <script src="js/core/constants.js"></script>
    <script src="js/pages/analytics.js"></script>
  </body>
</html>
